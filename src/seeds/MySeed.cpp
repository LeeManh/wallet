#include "seeds/MySeed.hpp"

json adminAccount = {{"username", "admin"},
                     {"password", "123456"},
                     {"email", "admin@gmail.com"},
                     {"fullName", "admin name"},
                     {"isAdmin", true},
                     {"isPasswordAutoGenerated", false}};

json adminWallet = {{
                        "point",
                        100.00,
                    },
                    {"walletType", models::WalletType::SYSTEM}};

namespace seeds {

bool Seed::initialize() {
  if (isSeeded()) return true;

  seedFiles();
  seedData();

  utils::MessageHandler::logSuccess("Khá»Ÿi táº¡o dá»¯ liá»‡u thÃ nh cÃ´ng!\n");

  return true;
}

bool Seed::seedFiles() {
  std::vector<std::string> requiredFiles = {"data/otps.json", "data/users.json",
                                            "data/wallets.json"};

  utils::MessageHandler::logMessage("\nğŸ“ Äang táº¡o cÃ¡c file cáº§n thiáº¿t:");
  utils::MessageHandler::logMessage("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

  for (const std::string& path : requiredFiles) {
    utils::storage::createFile(path);
    utils::MessageHandler::logMessage("  â”œâ”€ " + path + " âœ“");
  }
  utils::MessageHandler::logMessage("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n");

  return true;
}

bool Seed::seedData() {
  // Táº¡o admin
  models::User admin = services::UserService::createUser(
      adminAccount["username"], adminAccount["password"], adminAccount["email"],
      adminAccount["fullName"], adminAccount["isAdmin"],
      adminAccount["isPasswordAutoGenerated"]);
  services::UserService::saveUser(admin);

  // Táº¡o vÃ­ cho admin
  services::WalletService::createWallet(admin.getId(), adminWallet["point"],
                                        adminWallet["walletType"]);

  utils::MessageHandler::logMessage("\nğŸ‘¤ Äang táº¡o tÃ i khoáº£n admin:");
  utils::MessageHandler::logMessage("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
  utils::MessageHandler::logMessage("  â”œâ”€ TÃªn Ä‘Äƒng nháº­p: " +
                                    std::string(adminAccount["username"]));
  utils::MessageHandler::logMessage("  â”œâ”€ Máº­t kháº©u: " +
                                    std::string(adminAccount["password"]));
  utils::MessageHandler::logMessage("  â”œâ”€ Email: " +
                                    std::string(adminAccount["email"]));
  utils::MessageHandler::logMessage("  â”œâ”€ Há» vÃ  tÃªn: " +
                                    std::string(adminAccount["fullName"]));
  utils::MessageHandler::logMessage(
      "  â””â”€ Sá»‘ Ä‘iá»ƒm: " +
      utils::format::formatPoint(adminWallet["point"].get<double>()) + " Ä‘iá»ƒm");
  utils::MessageHandler::logMessage("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n");
  return true;
}

bool Seed::isSeeded() { return utils::storage::fileExists("data/users.json"); }

}  // namespace seeds